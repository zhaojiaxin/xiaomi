!function(t){function e(i){if(a[i])return a[i].exports;var n=a[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e,a){a(2),a(3),function(t){function e(){var e=[];l.each(function(){var a=t(this).attr("data-deliver-list");t(this).closest(".order-delivery").removeClass("hide"),e.push(a)}),MI.orderUtil.getDeliverInfo(e)}function i(e){var a=p.find("#J_getAuthcode"),i=p.find("#J_authcodeForm"),n=0;p.find(".modal-hd .title").text("验证信息"),MI.form.init(),a.on("click",function(e){function i(){var t=300;n=setInterval(function(){1===t?(clearInterval(n),d.removeClass("btn-disabled disabled").text("获取验证码")):(t-=1,a.text(t+"秒后重发").addClass("btn-disabled"))},1e3)}var d=t(this);e.preventDefault(),d.hasClass("disabled")||(d.addClass("disabled"),t.ajax({type:"POST",url:MI.GLOBAL_CONFIG.orderSite+"/order/getauthcode/orderId/"+C,dataType:"json",error:function(){d.removeClass("disabled")},success:function(t){1===t.code?i():(alert(t.msg),d.removeClass("disabled"))}}))}),g.off().on("click",function(t){t.preventDefault(),i.submit()}),i.on("submit",function(a){var d=t(this);a.preventDefault(),d.hasClass("disabled")||(d.addClass("disabled"),t.ajax({type:"POST",url:MI.GLOBAL_CONFIG.orderSite+"/order/checkauthcode/orderId/"+C,data:i.serialize(),dataType:"json",success:function(t){d.removeClass("disabled"),1===t.code?(p.removeClass("disabled"),clearInterval(n),e()):alert(t.msg)}}))})}function n(){u.on("click",function(e){e.preventDefault(),t(this).hasClass("disabled")||confirm(t(this).attr("data-confirm"))&&(t(this).addClass("disabled"),t.ajax({url:MI.GLOBAL_CONFIG.orderSite+"/user/cancleOrder",data:{order_id:t(this).attr("data-order-id")},dataType:"json",type:"POST",success:function(e){1===e.code?location.reload():alert(e.msg),t(this).removeClass("disabled")}}))})}function d(){function e(e,a){t.ajax({url:e,type:"POST",data:a.serialize(),dataType:"json",success:function(t){1===t.code?window.location.reload():alert(t.msg)}})}function a(){var e=null,a=null,i=null,n=null,d=t("#Provinces"),o=t("#Citys"),r=t("#Countys"),s=t("#Zipcode");d.on("change",function(){var n=t(this).val();"0"!==n?(MI.getRegions.getData(n,"Citys"),e=t(this).find("option:selected").html()):(e=null,a=null,i=null),o.attr("disabled",!0).find("option:gt(0)").remove(),r.attr("disabled",!0).find("option:gt(0)").remove()}),o.change(function(){var e=t(this).val();"0"!==e?(MI.getRegions.getData(e,"Countys"),a=t(this).find("option:selected").html()):(a=null,i=null),r.attr("disabled",!0).find("option:gt(0)").remove()}),r.change(function(){var e=t(this).val();"0"!==e?(i=t(this).find("option:selected").html(),n=t(this).find("option:selected").attr("zipcode"),s.val(n)):(i=null,n=null,s.val(""))})}function n(){var t=p.find("#J_updateAddrForm");p.find(".modal-hd .title").text("修改地址"),MI.form.init(),a(),g.off().on("click",function(e){e.preventDefault(),t.submit()}),t.on("submit",function(a){a.preventDefault(),e(r,t)})}function d(){p.hasClass("disabled")||(p.addClass("disabled"),t.ajax({url:o,dataType:"json",timeout:5e3,error:function(){alert("网络错误，请稍后再试。"),p.modal("hide")},success:function(t){1===t.code?(p.find(".modal-bd").html(t.data.html),"authcode"===t.data.type?(i(d),p.removeClass("disabled")):n()):(alert(t.msg),p.modal("hide"))}}))}var o=f.attr("data-get"),r=f.attr("data-update");f.on("click",function(t){t.preventDefault(),d(),p.modal({show:!0,backdrop:"static"})})}function o(){function e(){var e=a.find(".time-list"),i=e.find(".active").attr("data-value");e.find("> li").on("click",function(){t(this).addClass("active").siblings().removeClass("active")}),t("#J_submitEditTime").off("click").on("click",function(n){return n.preventDefault(),e.find("> .active").attr("data-value")===i?void a.modal("hide"):void t.ajax({url:m.attr("data-update"),type:"POST",data:{"Checkout[best_time]":e.find("> .active").attr("data-value")},dataType:"json",success:function(t){1===t.code?window.location.reload():alert(t.msg),a.modal("hide")}})})}var a=t("#J_modalEditTime");m.on("click",function(i){i.preventDefault(),a.modal({show:!0,backdrop:"static"}),t.ajax({url:m.attr("data-get"),type:"POST",dataType:"json",success:function(t){1===t.code?(a.find(".modal-bd").html(t.data.html),e(a.find(".time-list"))):alert(t.msg)}})})}function r(){function e(){t.ajax({type:"POST",url:MI.GLOBAL_CONFIG.orderSite+"/order/RefoundApply/orderId/"+C,data:t("#J_authcodeForm").serialize(),dataType:"json",success:function(e){1===e.code?setTimeout(function(){t(this).removeClass("disabled"),window.location.reload()},1500):(t(this).removeClass("disabled"),alert(e.msg))}})}h.on("click",function(a){a.preventDefault(),t.ajax({type:"GET",dataType:"json",url:MI.GLOBAL_CONFIG.orderSite+"/order/updaterender/orderId/"+C+"/type/refound_reply",success:function(t){1===t.code?(p.modal({show:!0,backdrop:"static"}).find(".modal-bd").html(t.data.html),i(e)):alert(t.msg)}})})}function s(){function e(t){for(var e=0,a=l.length;a>e;e+=1)if(l[e]===t)return!1;l.push(t),i()}function a(t){for(var e=0,a=l.length;a>e;e+=1)if(l[e]===t){l.splice(e,1);break}i()}function i(){l.length?s.removeClass("btn-dake btn-disabled").addClass("btn-primary"):s.removeClass("btn-primary").addClass("btn-dake btn-disabled")}function n(){t.ajax({url:MI.GLOBAL_CONFIG.orderSite+"/order/buyInsurance.php?"+(new Date).getTime(),dataType:"json",type:"POST",data:{order_id:t("#J_insuranceOrderId").text(),goods_id:l.join("|")},success:function(t){1===t.code?(v.modal("hide"),location.href=MI.GLOBAL_CONFIG.orderSite+"/user/orderView/"+t.data.order_id+"?from=orderViewInsurance"):alert(t.msg)}})}var d=t(".J_addInsurance"),o=t(".insurance-item"),r=t(".J_selectItem"),s=t(".J_submitInsurance"),l=[];-1!==location.href.indexOf("#buyInsurance")&&v.modal({backdrop:"static",show:!0}),d.on("click",function(e){var a=t(this).attr("data-insurance-id"),i=o.filter(function(){return t(this).attr("data-insurance-id")===a}),n=i.closest(".modal-body");e.preventDefault(),l=[],i.siblings(".insurance-item").removeClass("insurance-item-selected"),v.modal({backdrop:"static",show:!0}).one("shown",function(){i.find(".J_selectItem").trigger("click"),n.animate({scrollTop:200*i.index()},200)})}),r.on("click",function(i){var n=t(this).closest(".insurance-item");i.preventDefault(),n.hasClass("insurance-item-selected")?(n.removeClass("insurance-item-selected"),a(n.attr("data-insurance-id"))):(n.addClass("insurance-item-selected"),e(n.attr("data-insurance-id")))}),s.on("click",function(e){e.preventDefault(),t(this).hasClass("btn-disabled")||n()})}var l=t("[data-deliver-list]"),c=t(".J_deliveryTrigger"),u=t("#J_cancelOrder"),f=t(".J_editAddr"),m=t(".J_editTime"),h=t("#J_refoundApply"),p=t("#J_modalVerify"),v=t("#J_modalInsurance"),g=p.find("#J_submitForm"),b=t(".J_modalWaterInstall"),y=a(4),C=ORDERID;l.length&&!c.length&&e(),u.length&&n(),f.length&&d(),m.length&&o(),h.length&&r(),v.length&&s(),b.length&&y(),c.on("click",function(e){var a=t(this),i=a.prev(".order-delivery-detail");e.preventDefault(),a.hasClass("toggled")?(i.slideUp(),a.removeClass("toggled").html('展开物流详情 <i class="iconfont">&#xe61b;</i>')):(i.slideDown(),a.addClass("toggled").html('收起物流详情 <i class="iconfont">&#xe612;</i>'),a.hasClass("has-result")||(a.addClass("has-result"),MI.orderUtil.getDeliverInfo(i.find("[data-deliver-list]").attr("data-deliver-list"))))}),p.on("hidden",function(){t(this).removeClass("disabled").find(".modal-bd").empty()}),t("#J_orderUrge").on("click",function(){var e=t(this).hasClass("order-urge-success"),a=t(this).attr("data-order"),i=t(this);return e||!a?!1:(i.addClass("order-urge-loading"),void t.ajax({url:MI.GLOBAL_CONFIG.orderSite+"/order/urge?order_id="+a+"&_"+Math.random(),dataType:"json",timeout:5e3,error:function(){alert("网络错误，请稍后再试。")},success:function(t){1===t.code?i.removeClass("order-urge-loading").addClass("order-urge-success"):alert(t.msg)}}))})}(jQuery)},function(t,e){MI.getRegions={getUrl:"/region/index",getData:function(t,e,a){var i=this;$.ajax({type:"GET",url:i.getUrl,data:"parent="+t,dataType:"json",success:function(t){t&&i.formatData(t,e,a)}})},formatData:function(t,e,a){for(var i=t.regions,n=i.length,d=$("#"+e),o='<option value="0">'+d.children("option").eq(0).html()+"</option>",r=0;n>r;r+=1){var s=i[r].region_id===a?"selected":"";o+='<option zipcode="'+i[r].zipcode+'" value="'+i[r].region_id+'"'+s+">"+i[r].region_name+"</option>"}$("#"+e).html(o).prop("disabled",!1)}}},function(t,e){MI.namespace("orderUtil"),MI.orderUtil.getDeliverInfo=function(t){function e(t,e){for(var a=$('[data-deliver-list="'+t+'"]'),i="",n=0,d=e.length;d>n;n+=1){var o="";0===n?o=' class="first"':n===d-1&&(o=' class="last"'),i+="<li"+o+">"+e[n].context+" "+e[n].time+"</li>"}a.html(i)}function a(t){var e=$('[data-deliver-list="'+t+'"]');e.html('<li class="empty">暂无物流信息。</li>')}t&&$.ajax({url:"//cn.express.mi.com/express/query",data:{deliver_ids:$.isArray(t)?t.join(","):t,bts:$.cookie("xm_order_btauth")||""},dataType:"jsonp",jsonp:"jsonpcallback",success:function(i){if(1===i.code)for(var n in i.data)i.data.hasOwnProperty(n)&&i.data[n].length>0?e(n,i.data[n]):a(n);else if($.isArray(t))for(var d=0,o=t.length;o>d;d+=1)a(t[d]);else a(t)}})}},function(t,e,a){t.exports=function(){var t=a(5);$("body").append(t()).on("click",".J_modalWaterInstall",function(t){t.preventDefault(),$("#waterInstall").modal("show")})}},function(t,e){t.exports=function(t){var e='<div id="waterInstall" class="modal fade in modal-hide modal-water-install"> <div class="modal-header"> <h3>预约小米净水器或水龙头安装服务</h3> <span class="close" data-dismiss="modal"><i class="iconfont">&#xe602;</i></span> </div> <div class="modal-body"> <h4>购买须知：</h4> <ol class="icon-list clearfix"> <li>本服务采用线上预约，安装时工作人员采取上门收费的服务形式。</li> <li>确认预约之后，工作人员将在商品（小米净水器）出库后（订单可查询）的3个工作日内，与您取得联系并上门安装。</li> <li>同一次上门安装小米净水器和不锈钢无铅水龙头，只收取一次安装人工费用（50元/台）。</li> <li>往返距离大于30公里的上门服务属于远程服务,对超出30公里的路程部分收取远程费,收费标准为1元/公里。</li> </ol> <p> <a href="http://bbs.xiaomi.cn/t-11515570" target="_blank">了解更多细则 &raquo;</a> </p> <table> <caption> 收费标准： </caption> <thead> <tr> <th> 项目名称 </th> <th> 安装人工费用 </th> <th> 材料费用 </th> </tr> </thead> <tbody> <tr> <td> 安装小米净水器 </td> <td> 50元/台 </td> <td> －－ </td> </tr> <tr> <td> 安装不锈钢无铅水龙头 </td> <td> 50元/台 </td> <td> 240元 </td> </tr> </tbody> </table> <p>温馨提示：如果您无需更换水龙头，自己动手就可以完成净水器安装哦。<a href="http://www.mi.com/water/gallery/" target="_blank">参考安装演示 &raquo;</a></p> </div> <div class="modal-footer clearfix"> <a class="btn btn-primary" href="http://www.mi.com/service/contact" target="_blank">联系客服预约</a> </div></div>';return e}}]);