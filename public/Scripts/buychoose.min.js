!function(t){function e(i){if(a[i])return a[i].exports;var o=a[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e,a){function i(t,e){if(t&&e){var a=t.lastIndexOf("."),i=t.slice(a),o=t.slice(0,a),s=o+"!"+e+"x"+e+i;return s}}function o(t){var e={elm:".J_bubbleTipTrigger",conWidth:400,conHtml:"",zindex:999},a=$.extend(e,t),i=$(a.elm);if(i.length){a.conHtml||(a.conHtml=i.attr("data-content"));var o=i.outerWidth(),s=i.outerHeight(),n=i.offset().top,r=i.offset().left;i.on("click",function(t){t.stopPropagation();var e=$("<div />");e.attr({"class":"bubble-tip-content J_bubbleTipContent"}).css({width:a.conWidth+"px",position:"absolute",top:n+s+10+"px",left:r-a.conWidth/2+o/2,"z-index":a.zindex}).html("<p>"+a.conHtml+"</p>"),$("body").append(e)}),$(document).on("click.hideBubbleTip",function(t){var e=$(".J_bubbleTipContent");e.is(t.target)||0!==e.has(t.target).length||e.remove()})}}a(2),MI.namespace("buyChoose"),MI.buyChoose=function(){var t={packageData:null,stockData:null,lastStepNum:0,packageResult:{},insuranceResult:{},stepActiveClass:"active",stepLockClass:"lock",stepDisableClass:"disable",proFullName:"",hdInfoModeType:""},e=function(){return alert("参数错误!"),location.href=MI.GLOBAL_CONFIG.itemSite+"/buyphone/",!1},a=function(){window.chooseConfig&&window.chooseConfig.phone_type?($("#J_navBar").find(".J_item[data-pro="+window.chooseConfig.phone_type+"]").addClass("current").siblings().removeClass("current"),o()):e()},o=function(){return window.chooseConfig&&window.chooseConfig.version_data?void s(window.chooseConfig.version_data):e()},s=function(a){if(!a)return e();if(a.href_url&&$("#J_proMore").removeClass("hide").attr("href",a.href_url),$("#J_proImg").attr({src:a.img,alt:a.title}),$(".J_proDesc, #J_headerBarDesc").html(a.desc),a.price_min&&a.price_max){var i=a.price_min+"元";a.price_min<a.price_max&&(i+="起"),$(".J_proPrice").html(i)}t.proFullName=a.title,t.packageData=window.chooseConfig.package_data,n(),r(a),c()},n=function(){$.ajax({url:window.orderapi+"/stock/goods?gids="+window.chooseConfig.opensell_ids.join(","),dataType:"jsonp",jsonp:"jsonpcallback"}).done(function(e){t.stockData=e.data;var a=$('.J_step[data-index="1"]').find(".J_stepItem");a.hasClass(t.stepDisableClass)||1!==a.length||a.eq(0).trigger("click")})},r=function(e,a){var i=a?a:0;i+=1,i>1&&(e.lock=!0),e.stepIndex=i;var o=$(".J_step[data-index="+i+"]"),s=1,n=doT.template($("#J_chooseStepTemplate").html());if(o&&o.length>0){if(!e.children)return void o.empty();o.html(n(e)),s=o.find(".J_stepItem[data-index="+i+"]").eq(0).attr("data-node-id"),s=parseInt(s),t.lastStepNum=i,l(e,s,i)}else if(e.children){var r=$("<div>");r.addClass("pro-choose-step J_step"),r.attr("data-index",i),r.html(n(e)),$("#J_proStep").append(r),s=$(".J_stepItem[data-index="+i+"]").eq(0).attr("data-node-id"),s=parseInt(s,10),l(e,s,i)}},l=function(t,e,a){t&&e&&$.each(t.children,function(t,i){return i.node_id===e?(r(i,a),!1):void(i.children&&l(i,e,a))})},c=function(){$(".J_step").off().on("click",".J_stepItem",function(){var e=$(this).hasClass(t.stepLockClass),a=$(this).hasClass(t.stepDisableClass);if(!a&&!e){var i=parseInt($(this).attr("data-node-id")),o=parseInt($(this).attr("data-index")),s=$(this).attr("data-href");$(this).addClass(t.stepActiveClass).siblings().removeClass(t.stepActiveClass);var n=$(this).attr("data-desc")?$(this).attr("data-desc"):"";if($(".J_verDesc[data-index="+o+"]").html(n),s)return $("#J_chooseResultInit").find(".btn").attr("href",s).addClass("btn-primary").removeClass("btn-dakeLight"),void R();$("#J_chooseResultInit").find(".btn").attr("href","javascript:void(0);").addClass("btn-dakeLight").removeClass("btn-primary");var r=$(this).attr("data-title-price");r&&$(".J_proPrice").html(r),d(o),l(window.chooseConfig.version_data,i,o);var c=o+1,p=$(".J_step[data-index="+c+"]").find(".J_stepItem");p.removeClass(t.stepLockClass),w();var u=$(this).attr("data-gid");u?h($(this)):(T(),x());var f="";R(f);var m=p.not("."+t.stepDisableClass);1===m.length&&setTimeout(function(){p.eq(0).trigger("click")},0)}})},d=function(t){var e=parseInt(t,10),a=0;$(".J_step").each(function(){a=parseInt($(this).attr("data-index"),10),a>e&&$(this).empty()})},h=function(e){if(e&&!(e.length<=0)){var a=e.attr("data-img"),i=e.attr("data-gid"),o=e.attr("data-presales"),s=e.attr("data-presales-status"),n=e.attr("data-presales-url"),r=e.attr("data-openbuy"),l=e.attr("data-openbuy-status"),c=e.attr("data-opensell"),d=e.attr("data-opensell-status"),h=e.attr("data-opensell-url"),u=e.attr("data-href"),m=e.attr("data-fixedlink-url"),g=e.attr("data-fixedlink-txt"),v={};if(v.gid=i,v.presales="1"===o?!0:!1,v.presalesStatus="1"===s?!0:!1,v.presalesUrl=n,v.openbuy="1"===r?!0:!1,v.openbuyStatus="1"===l?!0:!1,v.openSell="1"===c?!0:!1,v.openSellStatus="1"===d?!0:!0,v.openSellUrl=h,m&&g)try{v.fixedlink_url=m,v.fixedlink_txt=g,v.is_fixedlink=!0}catch(_){}v.hrefUrl=u,a&&$("#J_proImg").attr("src",a),t.chooseResult=v;var b=p(v.gid);if(b)return f(),void T();if(v.openSell&&v.openSellStatus||v.presales&&v.presalesStatus||v.is_fixedlink){if(v.openSell&&v.openSellStatus&&t.stockData&&t.stockData[v.gid]){var k=t.stockData[v.gid];if(k&&!k.stock)return T(),v.openSellStatus=!1,void w(v)}t.packageData.length>0?J():w(v)}else T(),x()}},p=function(t){if(!t)return!1;var e=window.chooseConfig.book_bigtap_ids,a=!1;return $.each(e,function(e){return e===t?(a=!0,!1):void 0}),a},u=function(e){var a="//tptm.hd.mi.com/gettimestamp";$.ajax({url:a,dataType:"script",timeout:5e3,error:function(){t.serverTime=(new Date).getTime()/1e3,e()},success:function(){t.serverTime=servertime&&"number"==typeof servertime?servertime:(new Date).getTime()/1e3,"function"==typeof e&&e()}})},f=function(){var e=window.chooseConfig.book_bigtap_ids[t.chooseResult.gid];m(e)},m=function(e){e&&($("#J_chooseResultInit").addClass("hide"),$("#J_chooseResult").html('<a  class="btn btn-large btn-dakeLight" >正在加载...</a>').removeClass("hide"),u(function(){e.book_end_time>=t.serverTime&&e.is_book?g(0,e):e.buy_start_time>=t.serverTime?g(1,e):g(2,e)}))},g=function(e,a){var i=$("#J_chooseResult"),o=b(),s=MI.GLOBAL_CONFIG.orderSite+"/misc/subscribe/goods/"+t.chooseResult.gid;0===e?i.html('<a href="'+a.book_url+'" class="btn btn-large btn-primary" >立即预约</a>'):1===e&&a?(i.html('<a href="javascript:void(0);" class="btn btn-large btn-dakeLight btn-coutdown"  id="J_bigtapCoutdown">正在加载...</a>'),a.is_book&&a.book_check_url&&i.append('<a href="'+a.book_check_url+'" target="_blank">预约查询</a>'),o||i.append('<div class="choose-pre-login">您尚未登录，请提前 <a href="'+MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href+'">登录</a></div>'),_(a)):2===e&&a?k(a):3===e?t.packageData.length>0?($("#J_chooseResult").html('<a  class="btn btn-large btn-dakeLight" >下一步</a>').removeClass("hide"),J()):w(t.chooseResult):4===e?(i.html('<a href="javascript:void(0);" class="btn btn-large btn-dakeLight">未预约</a>'),a&&i.append('<a href="'+a.book_check_url+'" target="_blank">预约查询</a>'),v({msg:"抱歉，您未预约本轮开放购买，暂无购买资格。"})):5===e?i.html('<a href="'+s+'" class="btn btn-large btn-gray" >缺货登记</a>'):6===e?(v({msg:"抱歉，活动尚未开始！"}),i.html('<a href="javascript:void(0);" class="btn btn-large btn-dakeLight">活动未开始</a>')):7===e&&i.html('<a href="'+s+'" class="btn btn-large btn-gray" >缺货登记</a>')},v=function(t){if(t){var e=$("#J_modalBigtapTip"),a=e.find(".modal-body"),i=e.find(".modal-footer > .btn");a.html(t.msg),t.link?i.attr("href",t.link).html(t.linkText).removeAttr("data-dismiss"):i.removeAttr("href").html("看看其他商品").attr("data-dismiss","modal"),e.modal("show").on("hidden.bs.modal",function(){a.html("")})}},_=function(e){var a=$("#J_bigtapCoutdown");if(a.length&&e){var i,o,s=e.buy_start_time,n=parseInt((new Date).getTime()/1e3),r=0,l=!1,c=function(){r=t.serverTime-n,s-t.serverTime>=3600?g(7):p()},d=function(){a.html("正在加载..."),g(3)},h=function(){s-t.serverTime>=180&&180>=o&&!l&&(u(function(){r=t.serverTime-parseInt((new Date).getTime()/1e3)}),l=!0)},p=function(){if(i=parseInt((new Date).getTime()/1e3)+r,o=s-i,o>0){var t,e,n=Math.floor(o%60),l=Math.floor(o/60%60),c=Math.floor(o/3600%24),u=Math.floor(o/86400);u>0&&(c+=24*u),t=[n.toString(),l.toString(),c.toString(),u.toString()],e="<i>"+t[2]+"</i>小时<i>"+t[1]+"</i>分<i>"+t[0]+"</i>秒后 开售",0===c&&(e="<i>"+t[1]+"</i>分<i>"+t[0]+"</i>秒后 开售",0===l&&(e="<i>"+t[0]+"</i>秒后 开售")),h(),a.html(e),window.countDownTimer&&clearTimeout(window.countDownTimer),window.countDownTimer=setTimeout(function(){p()},1e3)}else d()};c()}},b=function(){var t=$.cookie("userId"),e=$.cookie("xm_order_btauth");return t&&e?!0:!1},k=function(e){var a=MI.GLOBAL_CONFIG.damiaoSite+"hdinfo/cn",i=b();return i?(e.is_book||(a+="?product="+t.chooseResult.gid),T(),x(),void $.ajax({url:a,dataType:"jsonp",jsonp:"callback",jsonpCallback:"hdinfo",data:{storage:"000",m:1},timeout:1e4,error:function(){alert("抱歉！网络错误，请刷新重试！")},success:function(a){if(a&&a.status){var i=a.status[t.chooseResult.gid];if(t.hdInfoModeType=a.dbe5a2,!i)return void g(5);i.hdstart&&!i.hdstop&&i.reg?g(3):!i.hdstart||i.hdstop||i.reg?g(!i.hdstart&&i.hdstop?5:6):e.is_book?g(4,e):g(3)}else alert("数据错误，请刷新重试！")}})):(window.location.href=MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href,!1)},w=function(e){if(e){var a=doT.template($("#J_chooseResuleTemplate").html()),i=a(e);$("#J_chooseResult").html(i).removeClass("hide"),$("#J_chooseResultInit").addClass("hide");var o=$("#J_proBuyBtn").attr("data-gid");t.primaryGoodsId=o,C(o)}else $("#J_chooseResultInit").removeClass("hide"),$("#J_chooseResult").addClass("hide").empty()},C=function(e,a){function i(){var e=MI.GLOBAL_CONFIG.cartSite+"/cart/recommend/goods_id/"+t.primaryGoodsId;t.packageResult&&t.packageResult.pid&&(e+="?package"),location.href=e}function o(e){if(e&&1===e.code)if(a)i();else if(t.packageResult.pid&&t.packageResult.list.length>0){var o=t.packageResult.pid+"-"+t.packageResult.list.join("|");C(o,!0)}else i();else 1!==e.code&&(alert(e.msg),a&&i())}return e?void(a?MI.addShopCart(e,o):MI.bigtapAddCart({obj:"#J_proBuyBtn",modeType:t.hdInfoModeType,callback:o,overCallback:function(t){v({msg:"抱歉！您选择的商品已售罄！"}),$(t).removeClass("btn-primary").addClass("btn-dakeLight").html("已售罄").removeAttr("id")}})):!1},J=function(e){var a=doT.template($("#J_packageTemplate").html()),i={},o=0;return i.stepIndex=t.lastStepNum+1,i.packageItem=[],i.lock=e?!0:!1,t.packageData.length<=0?!1:($.each(t.packageData,function(t,a){o=1*(parseFloat(a.market_price)-parseFloat(a.show_price)).toFixed(2),i.packageItem.push({title:a.commodity_name,packageId:a.commodity_id,save_price:o,show_price:a.show_price,lock:e?!0:!1})}),T(),x(),$("#J_proStep").append(a(i)),void $(".J_packageItem").on("click",function(){var e=$(this).attr("data-pid"),a=$(this).hasClass(t.stepActiveClass),i=$(this).hasClass(t.stepLockClass);a||i?($("#J_packageListBox").show(),$("#J_chooseMain").addClass("show-package")):($(this).addClass(t.stepActiveClass).siblings().removeClass(t.stepActiveClass),e?(I(e),t.packageResult.pid=e):x(),w(t.chooseResult),R())}))},I=function(e){if(e){var a=null;if($.each(t.packageData,function(t,i){return i.commodity_id===e?(a=i,!1):void 0}),a){var o=doT.template($("#J_packageListTemplate").html()),s={},n=1*(parseFloat(a.market_price)-parseFloat(a.show_price)).toFixed(2);s.title=a.commodity_name+"－<i>仅"+a.show_price+"元省"+n+"元</i>",s.list=[],$.each(a.list,function(t,e){s.list[t]={versions:[]},1===e.length&&(s.list[t].verHide=!0),$.each(e,function(e,a){0===e&&(s.list[t].goods_name=a.commodity_name,s.list[t].image=a.image),s.list[t].versions.push({image:i(a.image,140),icon:i(a.icon,14),gid:a.goods_id,title:a.commodity_name})})}),x(),$("#J_proStep").after(o(s)).addClass("show-package"),y()}}},y=function(){$(".J_packageListVersions").find(".J_item").on("click",function(){var t=$(this).attr("data-img"),e=$(this).attr("data-title");$(this).addClass("selected").siblings().removeClass("selected"),$(this).parent().siblings(".J_itemImg").find("img").attr({src:t}),$(this).parent().siblings(".J_itemTitle").html(e),D()}),$(".J_packageListVersions").each(function(){$(this).find(".J_item").eq(0).trigger("click")}),D()},x=function(e){e?$("#J_packageListBox").hide():($("#J_packageListBox").remove(),t.packageResult={}),$("#J_chooseMain").removeClass("show-package")},T=function(){$("#J_choosePackage").remove()},D=function(){t.packageResult.list=[],$(".J_packageListVersions").find(".J_item").each(function(){var e=$(this).hasClass("selected");if(e){var a=$(this).attr("data-gid");t.packageResult.list.push(a)}})},R=function(e){var a=t.proFullName;$(".J_stepItem").each(function(){$(this).hasClass("active")&&(a+=" "+$(this).attr("title"))}),e&&(a+=e),$("#J_chooseResultMsg .msg-bd").html(a),$("#J_headerBarDesc").html(a),$(".J_packageItem").each(function(){return $(this).hasClass("active")&&$(this).attr("data-pid")?(a+="<br>"+$(this).attr("title"),$("#J_chooseResultMsg  .msg-bd").html(a),!1):void 0})},S=function(t){var e=t+"&v="+parseInt((new Date).getTime()/1e5),a=MI.GLOBAL_CONFIG.itemSite+"/buyphone/getBuyphoneRecommend?phone_type="+e,i=$(".J_recommendGoods");$.ajax({url:a,method:"get",dataType:"json",error:function(){i.hide()},success:function(t){if(1===t.code){i.show();var e=doT.template($("#J_multiDescRecommend").html());i.find(".container").html(e(t.data))}else i.hide()}})},L={init:function(){var t=$(".pro-detail-box");$.each(window.chooseConfig.multi_desc,function(e,a){var i;"video"===a.type?(i=doT.template($("#J_multiDescVideo").html()),t.append(i(a.data))):"image"===a.type&&a.data.length?(i=doT.template(1===a.data.length?$("#J_multiDescImage").html():$("#J_multiDescSlider").html()),t.append(i(a.data))):"specs"===a.type&&(i=doT.template($("#J_multiDescSpecs").html()),t.append(i(a.data)))}),this.initialize()},initialize:function(){var t=this;t.slideshow($(".J_slide"),null),t.headerBar(),t.winResize(),this.bindEvt()},bindEvt:function(){var t=this;$(".J_showVideo").on("click",function(){var e=$(this).attr("data-video-url");return e&&t.showVideo(e),!1}),$("#J_showSpec").on("click",function(){$(this).toggleClass("spec-open"),$("#J_specCon").toggleClass("hide")}),$(window).on("resize",function(){t.winResize()}),$("#J_proDetailBox .section").on("visible.visibleWatcher",function(){$(".lazyload",this).each(function(){var t=$(this).attr("data-bg"),e=$(this).attr("data-img");if(t||e){var a=!!t;a?$(this).css("background-image","url("+t+")"):$(this).attr("src",e)}})}),$("#J_proDetailBox .section").visibleWatcher({offset:-300})},showVideo:function(t){var e='<iframe height="348" width="530" src="{{URL}}" frameborder="0" allowfullscreen=""></iframe>';t&&$("#J_showVideo").on("hidden.bs.modal",function(){$(this).find(".modal-body").html("")}).on("show.bs.modal",function(){$(this).find(".modal-body").html(e.replace("{{URL}}",t))}).modal("show")},slideshow:function(t,e){function a(t){i.eq(t).fadeIn(n.duration).siblings().fadeOut(n.duration),n.pager&&o.children(".page").eq(t).addClass("active").siblings().removeClass("active")}var i,o,s,n,r,l=$(t),c="",d='<a class="slide-previous">上一页</a><a class="slide-next">下一页</a>',h=0;return 0===l.length?l:l.length>1?(l.each(function(){L.slideshow($(this),e)}),l):(s={itemSelector:".slide",control:!0,pager:!0,auto:!1,delay:5e3,duration:300},n=$.extend({},s,e),i=l.find(n.itemSelector),i.length<=1?t:(i.wrapAll('<div class="slides-wrapper"></div>'),n.pager&&(c='<div class="pagination">',i.each(function(t){c+='<a class="page" href="javascript: void(0);">'+t+"</a>"}),c+="</div>",o=$(c),l.append(o),o.children(".page").on("click",function(t){t.preventDefault(),h=$(this).index(),a(h)})),n.control&&(l.append($(d)),l.find(".slide-previous").on("click",function(t){t.preventDefault(),h-=1,0>h&&(h=i.length-1),a(h)}),l.find(".slide-next").on("click",function(t){t.preventDefault(),h+=1,h>i.length-1&&(h=0),a(h)})),n.auto&&(r=setInterval(function(){h+=1,h>i.length-1&&(h=0),a(h)},n.delay)),void a(h)))},headerBar:function(){var t=$("#J_proDetailBox").offset().top,e=$("#J_headerBar"),a="header-bar-active";$(window).on("scroll",function(){$(this).scrollTop()>=t?e.addClass(a):e.removeClass(a)}),e.find(".btn").on("click",function(){$("html, body").animate({scrollTop:150},500)})},winResize:function(){var t=$(window).width(),e=$(".J_resizeItem"),a=1260;e.each(function(){var e=$(this).attr("data-src-orig"),i=$(this).attr("data-src-s");a>=t?i&&$(this).attr("src",i):e&&$(this).attr("src",e)})}},B=function(){var t=$(window).height(),e=680;e>=t&&$("#J_proImg").height("80%")},M=function(){a(),L.init(),B();var t=!1;$(window).on("scroll",function(){$(".J_recommendGoods").hasClass("is-visible")&&t===!1&&(S(window.chooseConfig.phone_type),t=!0)})};return{init:M}}(),$(document).ready(function(){MI.buyChoose.init(),o({conWidth:500})})},function(t,e){!function(t){function e(e){function a(){for(var e=-1,a=t(document).scrollTop(),i=0,o=c.length;o>i&&a+n.viewport.height()>c[i];i+=1)e+=1;return e}function i(){var e=a();l!==e&&(l=e,r.filter(function(e){return l>=e&&!t(this).hasClass(n.visibleClass)}).addClass(n.visibleClass).trigger("visible.visibleWatcher"),n.onVisible(r.eq(l),l))}function o(){r.each(function(){var e=t(this).attr("data-offset")?Number(t(this).attr("data-offset")):n.offset,a=e%1===0?e:e*n.viewport.height();c.push(t(this).offset().top+a)}),i(),n.onLoad()}var s,n,r=t(this),l=-1,c=[];s={viewport:t(window),visibleClass:"is-visible",offset:300,onLoad:t.noop,onVisible:t.noop},n=t.extend({},s,e),o(),n.viewport.on({"scroll.visibleWatcher":i,"resize.visibleWatcher":o})}t.fn.visibleWatcher=function(t){return e.call(this,t),this}}(jQuery)}]);