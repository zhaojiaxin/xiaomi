!function(t){function e(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e){MI.namespace("recommendAcc"),MI.recommendAcc={init:function(){this.config={gidArr:[],totalPrice:parseFloat($("#totalPrice").attr("data-phoneprice"))};var t=this;t.checkProList(),$(".J_tabNav > li").on("click",function(){var e=$(this).index();t.tab(e)}),$(".J_versionList").on("click",".item",function(){$(this).children("input").prop("checked",!0),t.choosePro($(this))}),insuranceData&&$.each(insuranceData,function(t,e){e&&$('.J_Insurance[data-phone="'+t+'"]').trigger("click")}),$(".J_proList").on("click","li > .J_del",function(){t.delPro($(this).parent(),!0)}),t.addBuy(),t.fixedSide(),location.href.indexOf("insurance=true")>=0?t.buySafe.safeEvent(!0):t.buySafe.safeEvent(),$("#nextBtn").removeAttr("href").click(function(){var e=$(".is-insurance"),i=t.config.gidArr.slice(0);if(i.length<=0)return void(location.href=MI.GLOBAL_CONFIG.cartSite+"/cart/");if(e.length){var a=e.attr("data-gid"),n=i.indexOf(a);if(a&&-1!==n){i.splice(n,1);var o=$(".is-insurance").attr("data-gid"),r=$(".is-insurance").attr("data-pid"),c=o+"?parent_itemId="+r;return MI.addShopCart(c,function(e){if(1===e.code){if(i.length<=0)return void(location.href=MI.GLOBAL_CONFIG.cartSite+"/cart/");t.addCart(i)}else alert(e.message)}),!1}t.addCart(i)}else t.addCart(i)})},addCart:function(t){var e="/cart/";t.length>0&&(e+="add/"+t.join("_"));var i=t.join("_");MI.addShopCart(i,function(t){1===t.code?location.href=MI.GLOBAL_CONFIG.cartSite+"/cart/":alert(t.message)})},checkProList:function(){var t=0,e=!1;return $(".pro-box").each(function(){$(this).children(".pro-item").length>0?(t+=1,e===!1&&(e=$(this).index())):$(".J_tabNav").children("li").eq($(this).index()).addClass("hide")}),0===t?($("#nextBtn").trigger("click"),!1):($(".J_tabNav").children("li").eq(e).addClass("selected").siblings("li").removeClass("selected"),$(".pro-box").eq(e).removeClass("hide"),$(".J_tabNav").addClass("tab-nav-"+t),$(".J_recommConBox").removeClass("hide"),void $(".J_loading").addClass("hide"))},tab:function(t){$(".J_tabNav").children("li").eq(t).addClass("selected").siblings().removeClass("selected"),$(".J_tabCon").children(".pro-box").eq(t).removeClass("hide").siblings().addClass("hide")},choosePro:function(t){var e=this,i=t.attr("data-type"),a=t.attr("data-name"),n=t.attr("data-img"),o=t.attr("data-gid"),r=parseFloat(t.attr("data-price")),c=t.hasClass("no"),s=$('.J_proList > li[data-type="'+i+'"]');return s.length>0&&e.delPro(s),c?(s.length>0&&s.children(".J_del").trigger("click"),!1):(t.addClass("selected"),$(".J_versionList").find('[data-type="'+i+'"]').removeClass("selected"),$("#proPic_"+i).attr("src",n),t.parent().parent().find(".show_price").html(r),e.config.gidArr.push(o),e.config.totalPrice+=r,e.countPrice(),void e.buildDom({price:r,type:i,gid:o,name:a}))},buildDom:function(t){var e=$('<li data-price="'+t.price+'" data-type="'+t.type+'" data-gid="'+t.gid+'"><span class="icon-del J_del iconfont" >&#xe602;</span>'+t.name+"</li>");$(".J_proList").append(e)},delPro:function(t,e){var i=this,a=t.attr("data-type"),n=t.attr("data-gid"),o=parseFloat(t.attr("data-price"));t.remove(),e&&$(".J_versionList").find('.no[data-type="'+a+'"]').find("input").prop("checked",!0),i.resetChoose({type:a,gid:n,price:o})},resetChoose:function(t){var e=$(".J_versionList").find('.item[data-type="'+t.type+'"]');e.removeClass("selected");var i=$.inArray(t.gid,this.config.gidArr);$("#proPic_"+t.type).attr("src",e.eq(0).attr("data-img")),i>=0&&this.config.gidArr.splice(i,1),this.config.totalPrice-=t.price,this.countPrice()},countPrice:function(){$("#totalPrice").html(this.fixFloatNum(this.config.totalPrice))},fixFloatNum:function(t){return-1===t.toFixed(2).toString().indexOf(".")?t.toFixed(2).toString():t.toFixed(2).toString().replace(/(.+?)(0{1,})$/,"$1").replace(/(.+)\.$/,"$1")},fixedSide:function(){var t=$(".J_sideBox").offset().top,e=$(".J_sideBox").offset().left;$(window).on("scroll",function(){var i=$(this).scrollTop(),a=$(this).height(),n=$(".J_sideBox").height();$(".J_sideBox").attr("style","").css(i>t&&a>n?{position:"fixed",top:0,left:e,"z-index":5}:{position:"static"})}).on("resize",function(){e=$(".J_recommConBox").offset().left+$(".J_recommConBox").outerWidth()+14,$(".J_sideBox").css({left:e})})},addBuy:function(){var t=this;$(".J_addBuy").children(".item").on("click",function(){if($(this).hasClass("item-safe"))return t.buySafe.init($(this)),!1;var e=$(this).attr("data-gid"),i=$(this).attr("data-index"),a=parseFloat($(this).attr("data-price")),n=$(this).attr("data-choose"),o=$(this).hasClass("selected")?!0:!1;if(o){$(this).removeClass("selected");var r=$.inArray(e,t.config.gidArr);t.config.gidArr.splice(r,1),t.config.totalPrice-=a}else{if("true"===n)return t.chooseGoods(i),!1;$(this).addClass("selected"),t.config.gidArr.push(e),t.config.totalPrice+=a}t.countPrice()})},chooseGoods:function(t){var e=this,i=$(".J_choosePro-"+t),a=i.find(".J_carouselList"),n=i.find(".J_chooseProBtn");e.showChoosePro(i),a.children("li").on("click",function(){$(this).addClass("selected").siblings().removeClass("selected"),$(this).find("input").prop("checked",!0),n.removeClass("btn-disabled").addClass("btn-primary")}),n.off().on("click",function(){if(!$(this).hasClass("btn-disabled")){var n=a.find(".selected").find("input").val(),o=$(".J_addBuy").find('.item[data-index="'+t+'"]'),r=parseFloat(o.attr("data-price"));i.modal("hide"),o.attr("data-gid",n).addClass("selected"),e.config.gidArr.push(n),e.config.totalPrice+=r,e.countPrice()}return!1})},showChoosePro:function(t){t&&t.on("shown.bs.modal",function(){}).modal({backdrop:"static",show:!0}).on("hide.bs.modal",function(){$(this).find(".page-btn-prev").removeClass("page-btn-prev-disabled").siblings(".page-btn-next").removeClass("page-btn-next-disabled")})},buySafe:{init:function(t){var e=this;e.config={obj:t,gid:t.attr("data-goodsid")+"?parent_itemId="+t.attr("data-parent_itemid"),price:parseFloat(t.attr("data-price")),count:t.attr("data-count")||1,itemId:""},$(".J_toBuyBaoxian").html("确认并购买服务"+e.config.count+"份"),t.hasClass("selected")?(e.config.itemId=t.attr("data-itemid"),e.delGoods()):e.showInfo()},showInfo:function(){$("#baoxian").modal({backdrop:"static",show:!0})},safeEvent:function(t){var e,i=this;if($(".J_baoxian_agree").on("click",function(){$(this).children(".iconfont").toggleClass("icon-checkbox-checked"),e=e?!1:!0}),$(".J_toBuyBaoxian").on("click",function(){e===!0?MI.addShopCart(i.config.gid,function(t){1===t.code?(i.config.obj.addClass("selected").attr("data-itemId",t.msg),MI.recommendAcc.config.totalPrice+=i.config.price,MI.recommendAcc.countPrice(),$("#baoxian").modal("hide")):alert(t.message)}):alert("请先阅读并同意《小米手机意外保障服务》！")}),t)if($(".hmnote2-insurance").length)$('#J_hmnote2Insurance input[name="hm_note2_insurance"]').trigger("click");else if($(".hmnote3-insurance").length)$('#J_hmnote3Insurance input[name="hm_note3_insurance"]').trigger("click");else if($(".m4c-insurance").length)$('#J_m4cInsurance input[name="m4c_insurance"]').trigger("click");else{var a=$(".J_addBuy").find(".item-safe");i.config={obj:a,gid:a.attr("data-goodsid")+"?parent_itemId="+a.attr("data-parent_itemid"),price:parseFloat(a.attr("data-price")),count:a.attr("data-count")||1,itemId:""},$(".J_baoxian_agree").trigger("click"),$(".J_toBuyBaoxian").trigger("click")}},delGoods:function(){var t=this;$.ajax({type:"POST",dataType:"json",url:"/cart/delete/"+t.config.itemId,cache:"false",success:function(e){1===e.code?(t.config.obj.removeClass("selected"),MI.recommendAcc.config.totalPrice-=t.config.price,MI.recommendAcc.countPrice()):alert(e.msg)}})}}},$(document).ready(function(){MI.recommendAcc.init()})}]);